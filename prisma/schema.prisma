generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Author {
  id           String    @id @default(uuid()) @db.Uuid
  slug         String    @unique @db.VarChar(100)
  name         String    @db.VarChar(255)
  email        String?   @db.VarChar(255)
  role         String    @db.VarChar(50)
  title        String?   @db.VarChar(100)
  avatar       String?   @db.VarChar(500)
  bio          String?
  longBio      String?   @map("long_bio")
  social       Json      @default("{}")
  joinedAt     DateTime? @map("joined_at") @db.Date
  articleCount Int       @default(0) @map("article_count")
  active       Boolean   @default(true)
  featured     Boolean   @default(false)
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  articles Article[]

  @@index([slug])
  @@index([role])
  @@index([active])
  @@map("authors")
}

model Category {
  id           String   @id @default(uuid()) @db.Uuid
  name         String   @db.VarChar(100)
  slug         String   @unique @db.VarChar(100)
  description  String?
  color        String?  @default("#facc15") @db.VarChar(20)
  icon         String?  @db.VarChar(50)
  articleCount Int      @default(0) @map("article_count")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz

  articles Article[]

  @@index([slug])
  @@map("categories")
}

model Issue {
  id           String    @id @default(uuid()) @db.Uuid
  number       Int       @unique
  title        String    @db.VarChar(255)
  theme        String    @db.VarChar(100)
  subtitle     String?   @db.VarChar(255)
  slug         String    @unique @db.VarChar(100)
  coverImage   String?   @map("cover_image") @db.VarChar(500)
  manifesto    String?
  editorsNote  String?   @map("editors_note")
  pdfUrl       String?   @map("pdf_url") @db.VarChar(500)
  pdfSize      String?   @map("pdf_size") @db.VarChar(50)
  publishDate  DateTime? @map("publish_date") @db.Date
  publishMonth String?   @map("publish_month") @db.VarChar(50)
  status       String    @default("draft") @db.VarChar(20)
  featured     Boolean   @default(false)
  articleCount Int       @default(0) @map("article_count")
  viewCount    Int       @default(0) @map("view_count")
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  articles Article[]

  @@index([slug])
  @@index([number])
  @@index([status])
  @@map("issues")
}

model Tag {
  id           String       @id @default(uuid()) @db.Uuid
  name         String       @unique @db.VarChar(100)
  slug         String       @unique @db.VarChar(100)
  articleCount Int          @default(0) @map("article_count")
  createdAt    DateTime     @default(now()) @map("created_at") @db.Timestamptz

  articles ArticleTag[]

  @@index([slug])
  @@map("tags")
}

model Article {
  id             String    @id @default(uuid()) @db.Uuid
  slug           String    @unique @db.VarChar(255)
  title          String    @db.VarChar(500)
  subtitle       String?   @db.VarChar(255)
  excerpt        String?
  content        String?
  image          String?   @db.VarChar(500)
  imageAlt       String?   @map("image_alt") @db.VarChar(255)
  imageCaption   String?   @map("image_caption") @db.VarChar(255)
  authorId       String?   @map("author_id") @db.Uuid
  issueId        String?   @map("issue_id") @db.Uuid
  categoryId     String?   @map("category_id") @db.Uuid
  readTime       Int       @default(5) @map("read_time")
  viewCount      Int       @default(0) @map("view_count")
  publishDate    DateTime? @map("publish_date") @db.Timestamptz
  status         String    @default("draft") @db.VarChar(20)
  featured       Boolean   @default(false)
  seoTitle       String?   @map("seo_title") @db.VarChar(255)
  seoDescription String?   @map("seo_description")
  seoKeywords    String[]  @map("seo_keywords")
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  author   Author?      @relation(fields: [authorId], references: [id], onDelete: SetNull)
  issue    Issue?       @relation(fields: [issueId], references: [id], onDelete: SetNull)
  category Category?    @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  tags     ArticleTag[]
  comments Comment[]

  @@index([slug])
  @@index([authorId])
  @@index([issueId])
  @@index([categoryId])
  @@index([status])
  @@index([featured])
  @@map("articles")
}

model ArticleTag {
  articleId String   @map("article_id") @db.Uuid
  tagId     String   @map("tag_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([articleId, tagId])
  @@index([articleId])
  @@index([tagId])
  @@map("article_tags")
}

model Subscriber {
  id                String    @id @default(uuid()) @db.Uuid
  email             String    @unique @db.VarChar(255)
  name              String?   @db.VarChar(255)
  status            String    @default("active") @db.VarChar(20)
  source            String?   @default("website") @db.VarChar(50)
  ipAddress         String?   @map("ip_address") @db.VarChar(45)
  userAgent         String?   @map("user_agent")
  subscribedAt      DateTime  @default(now()) @map("subscribed_at") @db.Timestamptz
  unsubscribedAt    DateTime? @map("unsubscribed_at") @db.Timestamptz
  confirmedAt       DateTime? @map("confirmed_at") @db.Timestamptz
  confirmationToken String?   @map("confirmation_token") @db.VarChar(255)
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz

  @@index([email])
  @@index([status])
  @@map("subscribers")
}

model Message {
  id        String    @id @default(uuid()) @db.Uuid
  name      String    @db.VarChar(255)
  email     String    @db.VarChar(255)
  phone     String?   @db.VarChar(50)
  subject   String?   @db.VarChar(255)
  message   String
  status    String    @default("new") @db.VarChar(20)
  notes     String?
  ipAddress String?   @map("ip_address") @db.VarChar(45)
  userAgent String?   @map("user_agent")
  repliedAt DateTime? @map("replied_at") @db.Timestamptz
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz

  @@index([status])
  @@map("messages")
}

model AuthorApplication {
  id              String    @id @default(uuid()) @db.Uuid
  name            String    @db.VarChar(255)
  email           String    @db.VarChar(255)
  phone           String?   @db.VarChar(50)
  bio             String?
  sampleWork      String?   @map("sample_work")
  sampleWorkFile  String?   @map("sample_work_file") @db.VarChar(500)
  portfolioUrl    String?   @map("portfolio_url") @db.VarChar(500)
  socialLinks     Json      @default("{}") @map("social_links")
  topicsOfInterest String[] @map("topics_of_interest")
  status          String    @default("pending") @db.VarChar(20)
  notes           String?
  reviewedBy      String?   @map("reviewed_by") @db.Uuid
  reviewedAt      DateTime? @map("reviewed_at") @db.Timestamptz
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz

  @@index([status])
  @@map("author_applications")
}

model User {
  id            String    @id @default(uuid()) @db.Uuid
  email         String    @unique @db.VarChar(255)
  passwordHash  String?   @map("password_hash") @db.VarChar(255)
  name          String?   @db.VarChar(255)
  avatar        String?   @db.VarChar(500)
  role          String    @default("viewer") @db.VarChar(50)
  authorId      String?   @map("author_id") @db.Uuid
  active        Boolean   @default(true)
  emailVerified Boolean   @default(false) @map("email_verified")
  lastLogin     DateTime? @map("last_login") @db.Timestamptz
  loginCount    Int       @default(0) @map("login_count")
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  media               Media[]
  newsletterCampaigns NewsletterCampaign[]

  @@index([email])
  @@index([role])
  @@map("users")
}

model Media {
  id           String   @id @default(uuid()) @db.Uuid
  filename     String   @db.VarChar(255)
  originalName String?  @map("original_name") @db.VarChar(255)
  url          String   @db.VarChar(500)
  thumbnailUrl String?  @map("thumbnail_url") @db.VarChar(500)
  type         String?  @db.VarChar(50)
  mimeType     String?  @map("mime_type") @db.VarChar(100)
  size         Int?
  width        Int?
  height       Int?
  folder       String?  @default("uploads") @db.VarChar(100)
  altText      String?  @map("alt_text") @db.VarChar(255)
  caption      String?
  uploadedById String?  @map("uploaded_by") @db.Uuid
  usedIn       Json     @default("[]") @map("used_in")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz

  uploadedBy User? @relation(fields: [uploadedById], references: [id], onDelete: SetNull)

  @@index([type])
  @@index([folder])
  @@map("media")
}

model PageView {
  id         String   @id @default(uuid()) @db.Uuid
  path       String   @db.VarChar(500)
  articleId  String?  @map("article_id") @db.Uuid
  issueId    String?  @map("issue_id") @db.Uuid
  referrer   String?  @db.VarChar(500)
  userAgent  String?  @map("user_agent")
  ipHash     String?  @map("ip_hash") @db.VarChar(64)
  country    String?  @db.VarChar(100)
  city       String?  @db.VarChar(100)
  deviceType String?  @map("device_type") @db.VarChar(50)
  browser    String?  @db.VarChar(100)
  os         String?  @db.VarChar(100)
  sessionId  String?  @map("session_id") @db.VarChar(100)
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@index([articleId])
  @@index([issueId])
  @@index([path])
  @@map("page_views")
}

model NewsletterCampaign {
  id               String    @id @default(uuid()) @db.Uuid
  subject          String    @db.VarChar(255)
  previewText      String?   @map("preview_text") @db.VarChar(255)
  content          String
  template         String?   @default("default") @db.VarChar(50)
  status           String    @default("draft") @db.VarChar(20)
  recipientCount   Int       @default(0) @map("recipient_count")
  sentCount        Int       @default(0) @map("sent_count")
  openCount        Int       @default(0) @map("open_count")
  clickCount       Int       @default(0) @map("click_count")
  bounceCount      Int       @default(0) @map("bounce_count")
  unsubscribeCount Int       @default(0) @map("unsubscribe_count")
  scheduledAt      DateTime? @map("scheduled_at") @db.Timestamptz
  sentAt           DateTime? @map("sent_at") @db.Timestamptz
  createdById      String?   @map("created_by") @db.Uuid
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  createdBy User? @relation(fields: [createdById], references: [id])

  @@index([status])
  @@map("newsletter_campaigns")
}

model Setting {
  id          String   @id @default(uuid()) @db.Uuid
  key         String   @unique @db.VarChar(100)
  value       Json
  description String?
  category    String?  @default("general") @db.VarChar(50)
  updatedById String?  @map("updated_by") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([key])
  @@index([category])
  @@map("settings")
}

model ActivityLog {
  id         String   @id @default(uuid()) @db.Uuid
  userId     String?  @map("user_id") @db.Uuid
  action     String   @db.VarChar(100)
  entityType String   @map("entity_type") @db.VarChar(50)
  entityId   String?  @map("entity_id") @db.Uuid
  oldValues  Json?    @map("old_values")
  newValues  Json?    @map("new_values")
  ipAddress  String?  @map("ip_address") @db.VarChar(45)
  userAgent  String?  @map("user_agent")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@index([userId])
  @@index([entityType, entityId])
  @@map("activity_log")
}

model Comment {
  id        String   @id @default(uuid()) @db.Uuid
  articleId String   @map("article_id") @db.Uuid
  parentId  String?  @map("parent_id") @db.Uuid
  name      String   @db.VarChar(255)
  email     String   @db.VarChar(255)
  content   String
  status    String   @default("active") @db.VarChar(20)
  likes     Int      @default(0)
  isAdmin   Boolean  @default(false) @map("is_admin")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  article   Article   @relation(fields: [articleId], references: [id], onDelete: Cascade)
  parent    Comment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   Comment[] @relation("CommentReplies")

  @@index([articleId])
  @@index([parentId])
  @@index([status])
  @@map("comments")
}